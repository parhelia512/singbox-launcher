# Открытые вопросы по ТЗ рефакторинга визарда

## Вопросы по архитектуре

### 1. Где будет находиться GUIState?
**Текущее:** В ТЗ указано "в `ui/wizard/presentation/` или отдельном файле"
**Вопрос:** Где конкретно? В отдельном файле `ui/wizard/presentation/gui_state.go` или в `presenter.go`?

### 2. Методы WizardState (SaveConfigWithBackup, SetCheckURLState и т.д.)
**Текущее:** В WizardState есть методы:
- `SaveConfigWithBackup()` - сохранение конфигурации с бэкапом
- `SetCheckURLState()` - управление состоянием кнопки Check
- `SetSaveState()` - управление состоянием кнопки Save
- `SetTemplatePreviewText()` - установка текста preview
- `RefreshOutboundOptions()` - обновление опций outbound
- `InitializeTemplateState()` - инициализация состояния template
- `GetAvailableOutbounds()` - получение доступных outbounds
- `EnsureFinalSelected()` - обеспечение выбранного final outbound

**Вопрос:** Куда они перейдут?
- В презентер (как методы WizardPresenter)?
- В бизнес-логику (как функции, работающие с моделью)?
- Будет ли разделение (например, SaveConfigWithBackup в бизнес-логику, а SetCheckURLState в презентер)?

### 3. helpers.go
**Текущее:** `ui/wizard/state/helpers.go` содержит:
- Логирование (DebugLog, InfoLog, ErrorLog)
- SafeFyneDo
- Управление уровнем логирования

**Вопрос:** 
- Останется ли helpers.go?
- Будет ли перемещен в presentation или останется в state?
- Или логирование будет в другом месте?

### 4. Диалоги (dialogs/)
**Текущее:** Есть `ui/wizard/dialogs/` с диалогами добавления/редактирования правил
**Вопрос:** 
- Останутся ли они в dialogs/?
- Должны ли быть в presentation layer?
- Как они будут взаимодействовать с презентером?

### 5. UIUpdater интерфейс
**Текущее:** В ТЗ упоминается интерфейс UIUpdater для обновления GUI
**Вопрос:**
- Где будет определен (business или presentation)?
- Будет ли один интерфейс или несколько специализированных?
- Кто его реализует (презентер, адаптер)?

### 6. Синхронизация модель ↔ GUI
**Текущее:** В ТЗ есть методы SyncModelToGUI() и SyncGUIToModel()
**Вопрос:**
- Когда вызывается синхронизация? По событиям (event-driven) или по требованию?
- Как часто синхронизируется? При каждом изменении модели или пакетно?
- Нужна ли оптимизация (например, debounce для частых обновлений)?

### 7. SelectableRuleState.OutboundSelect
**Текущее:** 
- В WizardState.SelectableRuleState есть поле `OutboundSelect *widget.Select`
- В новой модели RuleState этого поля нет (правильно - только данные)
- Но виджеты нужны в GUIState

**Вопрос:** 
- Как связать RuleState из модели с виджетом Select в GUIState?
- Нужен ли индекс или ID для связи?
- Или в GUIState будет отдельная структура для хранения виджетов правил?

### 8. Флаги состояния (CheckURLInProgress, SaveInProgress и т.д.)
**Текущее:** В WizardState есть флаги:
- CheckURLInProgress
- SaveInProgress  
- AutoParseInProgress
- PreviewGenerationInProgress
- ParserConfigUpdating
- UpdatingOutboundOptions

**Вопрос:** 
- Куда они перейдут? В модель или в GUIState?
- Или часть в модель (бизнес-логика), часть в GUIState (UI состояние)?

### 9. OpenRuleDialogs
**Текущее:** В WizardState есть `OpenRuleDialogs map[int]fyne.Window`
**Вопрос:** 
- Где хранить информацию об открытых диалогах?
- В GUIState (так как это GUI состояние)?
- В презентере?

### 10. Константы (DefaultOutboundTag, RejectActionName и т.д.)
**Текущее:** Константы определены в state.go
**Вопрос:**
- Куда перенести константы?
- В models (так как они связаны с бизнес-логикой)?
- В utils?
- Оставить в state (если state останется)?

### 11. Controller в WizardModel
**Текущее:** В WizardState есть поле `Controller *core.AppController`
**Вопрос:**
- Нужен ли Controller в модели?
- Или он будет только в презентере?
- Как бизнес-логика будет получать доступ к сервисам (ConfigService, FileService)?

### 12. TemplateData
**Текущее:** TemplateData загружается в wizard.go и передается в state
**Вопрос:**
- Где будет загружаться TemplateData после рефакторинга?
- В презентере при инициализации?
- Передается ли в модель или только используется в презентере?

## Вопросы по реализации

### 13. Детали тестирования
**Вопрос:**
- Какие именно тесты нужны? Unit тесты для бизнес-логики, интеграционные для презентеров?
- Нужны ли тесты для GUI (UI тесты)?
- Как тестировать презентеры с моками GUI - какие интерфейсы нужны?

### 14. Порядок выполнения
**Текущее:** В ТЗ указан порядок выполнения
**Вопрос:**
- Можно ли делать некоторые этапы параллельно?
- Или строго последовательно?
- Есть ли зависимости между этапами, которые требуют последовательности?

### 15. Дублирование констант
**Текущее:** В ТЗ есть задача устранить дублирование констант (MaxJSONConfigSize vs MaxConfigFileSize)
**Вопрос:**
- Когда это делать? Сразу в Фазе 1 или позже?
- Это часть рефакторинга или отдельная задача?

### 16. Миграция существующих тестов
**Текущее:** В ТЗ сказано "удалить старые тесты, которые тестируют устаревшую архитектуру"
**Вопрос:**
- Какие тесты считаются "устаревшими"?
- Тесты, которые тестируют функции с `*WizardState`?
- Или нужно оценить каждый тест отдельно?

### 17. Производительность
**Текущее:** В ТЗ есть риск производительности
**Вопрос:**
- Есть ли известные проблемы с производительностью в текущей реализации?
- Какие метрики использовать для проверки производительности?
- Есть ли требования по производительности (например, время отклика UI)?

### 18. Обработка ошибок
**Вопрос:**
- Как будут обрабатываться ошибки в новой архитектуре?
- Через презентер (показ диалогов)?
- Или бизнес-логика возвращает ошибки, а презентер их обрабатывает?

## Рекомендации

Рекомендуется уточнить эти вопросы перед началом рефакторинга, чтобы избежать переделок и неясностей в процессе работы.

