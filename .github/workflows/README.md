# GitHub Actions ‚Äî CI/CD (–∫—Ä–∞—Ç–∫–æ)

–î–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç –Ω–æ–≤—É—é –ª–æ–≥–∏–∫—É CI –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞ **Sing-Box Launcher**: —Ç—Ä–∏ —Ä–µ–∂–∏–º–∞ –∑–∞–ø—É—Å–∫–∞, —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –≤–µ—Ä—Å–∏–π –∏ –ø–æ–≤–µ–¥–µ–Ω–∏–µ —Ä–µ–ª–∏–∑–æ–≤.

---

## üîß –ü–æ–ª–∏—Ç–∏–∫–∞ CI ‚Äî —á—Ç–æ –∏ –∫–æ–≥–¥–∞

- push –≤ `main` / PR –≤ `main` ‚Üí **—Ç–æ–ª—å–∫–æ —Ç–µ—Å—Ç—ã**
- push —Ç–µ–≥–∞ `v*` ‚Üí **build + release (stable)**
- —Ä—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ `workflow_dispatch` ‚Üí —É–ø—Ä–∞–≤–ª—è–µ–º–æ —á–µ—Ä–µ–∑ `run_mode`:
  - `tests` ‚Äî —Ç–æ–ª—å–∫–æ —Ç–µ—Å—Ç—ã
  - `build` ‚Äî —Å–±–æ—Ä–∫–∞ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤ (–±–µ–∑ —Ä–µ–ª–∏–∑–∞)
  - `prerelease` ‚Äî —Å–±–æ—Ä–∫–∞ + —Å–æ–∑–¥–∞–Ω–∏–µ prerelease (–∞–Ω–Ω–æ—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–≥ + —Ä–µ–ª–∏–∑)

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã: `run_mode` (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –≤—ã–±–æ—Ä), `skip_tests` (boolean), `target` (—Å—Ç—Ä–æ–∫–∞, –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ).

**target** ‚Äî –∫–∞–∫–∏–µ —Å–±–æ—Ä–∫–∏ –∑–∞–ø—É—Å–∫–∞—Ç—å (—á–µ—Ä–µ–∑ –ø—Ä–æ–±–µ–ª: `macOS`, `Win64`, `Win7`). –ü—É—Å—Ç–æ = –≤—Å–µ —Ç—Ä–∏. –ü—Ä–∏–º–µ—Ä: `macOS Win64` ‚Äî —Ç–æ–ª—å–∫–æ macOS –∏ Win64, –±–µ–∑ Win7.

---

## üß© –ö–∞–∫ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –≤–µ—Ä—Å–∏–∏

- –ù–∞ —Ç–µ–≥–∞—Ö `vX.Y.Z`:
  - version = `vX.Y.Z`
  - prerelease = `false`
  - tag = `vX.Y.Z`
- –†—É—á–Ω–æ–π `prerelease`:
  - version = `git describe --tags --always --exclude='*-prerelease'` + `-prerelease` (–Ω–∞–ø—Ä–∏–º–µ—Ä `v0.8.0-16-gc185054-prerelease`)
  - prerelease = `true`
  - —Å–æ–∑–¥–∞—ë—Ç—Å—è –∞–Ω–Ω–æ—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–≥ —Å —ç—Ç–∏–º –∏–º–µ–Ω–µ–º –∏ –ø—É—à–∏—Ç—Å—è (—Ñ–∏–ª—å—Ç—Ä –≤ –ª–æ–∫–∞–ª—å–Ω—ã—Ö —Å–±–æ—Ä–∫–∞—Ö: `--exclude='*-prerelease'`)
- –†—É—á–Ω–æ–π `build` (–±–µ–∑ —Ä–µ–ª–∏–∑–∞):
  - version = `dev.<branch-sanitized>.<sha7>` (–±–µ–∑ `v.`)
  - prerelease = `false`
  - —Ç–µ–≥ –Ω–µ —Å–æ–∑–¥–∞—ë—Ç—Å—è

---

## üöÄ Job‚Äë—ã –∏ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã

- Test job: –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø–æ push –≤ main, PR, –∏–ª–∏ –≤—Ä—É—á–Ω—É—é (run_mode=tests).
- Build job'—ã (–ø—Ä–∏ —Ç–µ–≥–µ `v*` –∏–ª–∏ run_mode=build|prerelease):
  - **build-darwin** ‚Äî macOS (—É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π .app + Catalina Intel-only); –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è, –µ—Å–ª–∏ `target` –ø—É—Å—Ç–æ –∏–ª–∏ —Å–æ–¥–µ—Ä–∂–∏—Ç `macOS`.
  - **build-windows** ‚Äî Win64 (.exe); –µ—Å–ª–∏ `target` –ø—É—Å—Ç–æ –∏–ª–∏ —Å–æ–¥–µ—Ä–∂–∏—Ç `Win64`.
  - **build-win7** ‚Äî Win7 x86; –µ—Å–ª–∏ `target` –ø—É—Å—Ç–æ –∏–ª–∏ —Å–æ–¥–µ—Ä–∂–∏—Ç `Win7`.
  –ù–∞ `macos-latest` –¥–≤–∞ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∞: —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –∏ `*-macos-catalina.zip`.
- Release job: –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ–≥–æ build –¥–ª—è —Ç–µ–≥–æ–≤ (stable) –∏–ª–∏ –ø—Ä–∏ —Ä—É—á–Ω–æ–º `run_mode=prerelease`; –ø–æ–¥—Ç—è–≥–∏–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã —Ç–µ—Ö —Å–±–æ—Ä–æ–∫, —á—Ç–æ —Ä–µ–∞–ª—å–Ω–æ –∑–∞–ø—É—Å–∫–∞–ª–∏—Å—å.

–ê—Ä—Ç–µ—Ñ–∞–∫—Ç—ã: `artifacts-darwin`, `artifacts-windows`, `artifacts-macos-catalina`, `artifacts-windows-win7-32`.

---

## üß™ –ü—Ä–∏–º–µ—Ä—ã –∫–æ–º–∞–Ω–¥ (cli)

- –ü—Ä–µ—Ä–µ–ª–∏–∑ —Å —Ç–µ—Å—Ç–∞–º–∏:
  gh workflow run ci.yml --ref develop -f run_mode=prerelease -f skip_tests=false
- –ü—Ä–µ—Ä–µ–ª–∏–∑ –±–µ–∑ —Ç–µ—Å—Ç–æ–≤:
  gh workflow run ci.yml --ref develop -f run_mode=prerelease -f skip_tests=true
- –†—É—á–Ω–æ–π build:
  gh workflow run ci.yml --ref develop -f run_mode=build -f skip_tests=true
- –†—É—á–Ω–æ–π build —Ç–æ–ª—å–∫–æ Win7:
  gh workflow run ci.yml --ref develop -f run_mode=build -f skip_tests=true -f target=Win7
- –†—É—á–Ω–æ–π build —Ç–æ–ª—å–∫–æ macOS –∏ Win64 (–±–µ–∑ Win7):
  gh workflow run ci.yml --ref develop -f run_mode=build -f skip_tests=true -f "target=macOS Win64"
- –¢–µ—Å—Ç—ã –≤—Ä—É—á–Ω—É—é:
  gh workflow run ci.yml --ref develop -f run_mode=tests

### üîç –ó–∞–ø—É—Å–∫ `golangci-lint`

- –í—Ä—É—á–Ω—É—é (—á–µ—Ä–µ–∑ `workflow_dispatch`):
  gh workflow run golangci-lint.yml --ref develop
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ PR: workflow –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–µ –ø—Ä–∏ —Å–æ–±—ã—Ç–∏—è—Ö `opened`, `reopened`, `synchronize` –Ω–∞ pull request ‚Äî –Ω–∏—á–µ–≥–æ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –¥–µ–ª–∞—Ç—å –Ω–µ –Ω—É–∂–Ω–æ.

> –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: workflow –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–æ matrix (`ubuntu-latest`, `macos-latest`, `windows-latest`) –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Go 1.25; –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –º–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å `golangci-lint` –ª–æ–∫–∞–ª—å–Ω–æ (`golangci-lint run`) –ø–æ—Å–ª–µ `go mod tidy`.

### ü§ñ Dependabot

- –ù–∞—Å—Ç—Ä–æ–π–∫–∞: `.github/dependabot.yml` ‚Äî –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–ª—è `gomod` (–µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ), –ª–∏–º–∏—Ç –æ—Ç–∫—Ä—ã—Ç—ã—Ö PR ‚Äî 10, –º–µ—Ç–∫–∏ `dependencies`, —Ä–µ–≤—å—é–≤–µ—Ä `Leadaxe`.
- –î–ª—è —Ä—É—á–Ω–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª—è: –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å GitHub ‚Üí Security / Dependabot –∏–ª–∏ —Å–æ–∑–¥–∞–≤–∞–π—Ç–µ PR —Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º `go.mod` –≤—Ä—É—á–Ω—É—é.

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

- –î–ª—è –ø—É—à–∞ —Ç–µ–≥–æ–≤ –∏ —Å–æ–∑–¥–∞–Ω–∏—è —Ä–µ–ª–∏–∑–æ–≤ `GITHUB_TOKEN` –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å `contents: write` (–≤ workflow —É–∂–µ –≤—ã—Å—Ç–∞–≤–ª–µ–Ω–æ).
- –ú—ã —Å–æ–∑–¥–∞—ë–º –∞–Ω–Ω–æ—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–µ–≥–∏ –¥–ª—è prerelease –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ –æ—Ç–ª–∞–¥–∫–∏ (`git tag -a`).
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —Ç–µ–≥–∞ —Å–µ–π—á–∞—Å –ª–æ–∫–∞–ª—å–Ω–∞—è; –º–æ–∂–Ω–æ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ `git fetch --tags` –∏–ª–∏ `git ls-remote` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ remote.
- `build` ‚Äî —ç—Ç–æ –Ω–µ `release`. –ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—É–±–ª–∏–∫–∞—Ü–∏—é –ø—Ä–∏ `build`, –∏–∑–º–µ–Ω–∏—Ç–µ –ø—Ä–∞–≤–∏–ª–∞ –≤ `meta/release`.

